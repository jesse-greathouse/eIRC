#!/usr/bin/perl
use strict;
use warnings;

use Cwd qw(getcwd abs_path);
use File::Basename;
use lib(dirname(abs_path(__FILE__)) . "/modules");
use eIRC::Web qw(web_start web_restart web_stop web_kill web_help);

# Dispatch table for available actions
my %actions = (
    start   => \&web_start,
    restart => \&web_restart,
    stop    => \&web_stop,
    kill    => sub {
        web_stop();
        web_kill();
    },
    help    => \&web_help,,
);

# Entry point
my $action = shift @ARGV || '';

if (exists $actions{$action}) {
    $actions{$action}->();
} else {
    print "Unknown action: '$action'\nUse 'help' to see available options.\n";
    web_help();
    exit(1);
}

# Help output
sub print_help {
    print <<'EOF';
Usage: web [ACTION]

Manage the web service via the following actions:

Examples:
  web start              # Start the web service
  web restart            # Restart the web service
  web stop               # Stop the web service
  web kill               # Stop service and the supervisor daemon (needed for a config change)
  web help               # Show this help information

 Main operation modes:
  start                  Start the web service
  restart                Restart the web service
  stop                   Gracefully stop the web service
  kill                   Force kill the supervisor daemon (needed for a config change)
  help                   Display this help message

EOF
}
